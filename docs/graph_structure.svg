<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="1000" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333333" />
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
      <feOffset dx="2" dy="2" result="offsetblur"/>
      <feComponentTransfer>
        <feFuncA type="linear" slope="0.3"/>
      </feComponentTransfer>
      <feMerge>
        <feMergeNode/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>
  
  <!-- Title -->
  <text x="400" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#333333">
    LangGraph Story Generation Workflow
  </text>
  
  <!-- story_writer node -->
  <rect x="300" y="80" width="200" height="60" rx="10" fill="#4A90E2" stroke="#000000" stroke-width="2" filter="url(#shadow)"/>
  <text x="400" y="105" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">story_writer</text>
  <text x="400" y="125" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Generates story text and title</text>
  
  <!-- image_prompter node -->
  <rect x="100" y="200" width="180" height="60" rx="10" fill="#7ED321" stroke="#000000" stroke-width="2" filter="url(#shadow)"/>
  <text x="190" y="225" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">image_prompter</text>
  <text x="190" y="245" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Creates DALL-E prompts</text>
  
  <!-- video_prompter node -->
  <rect x="520" y="200" width="180" height="60" rx="10" fill="#7ED321" stroke="#000000" stroke-width="2" filter="url(#shadow)"/>
  <text x="610" y="225" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">video_prompter</text>
  <text x="610" y="245" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Creates Sora prompts</text>
  
  <!-- Parallel label -->
  <text x="400" y="185" font-family="Arial, sans-serif" font-size="11" font-style="italic" text-anchor="middle" fill="#666666">Parallel Execution</text>
  
  <!-- route_to_generators node -->
  <rect x="300" y="320" width="200" height="60" rx="10" fill="#F5A623" stroke="#000000" stroke-width="2" filter="url(#shadow)"/>
  <text x="400" y="345" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">route_to_generators</text>
  <text x="400" y="365" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Fan-out: creates Send instances</text>
  
  <!-- generate_single_image node -->
  <rect x="50" y="450" width="200" height="80" rx="10" fill="#BD10E0" stroke="#000000" stroke-width="2" filter="url(#shadow)"/>
  <text x="150" y="475" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">generate_single_image</text>
  <text x="150" y="495" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">(×N parallel)</text>
  <text x="150" y="515" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Generates single image</text>
  
  <!-- generate_single_video node -->
  <rect x="550" y="450" width="200" height="80" rx="10" fill="#BD10E0" stroke="#000000" stroke-width="2" filter="url(#shadow)"/>
  <text x="650" y="475" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">generate_single_video</text>
  <text x="650" y="495" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">(×M parallel)</text>
  <text x="650" y="515" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Generates single video</text>
  
  <!-- Fan-out label -->
  <text x="400" y="440" font-family="Arial, sans-serif" font-size="11" font-style="italic" text-anchor="middle" fill="#666666">Dynamic Fan-out (one Send per prompt)</text>
  
  <!-- assembler node -->
  <rect x="300" y="600" width="200" height="60" rx="10" fill="#50E3C2" stroke="#000000" stroke-width="2" filter="url(#shadow)"/>
  <text x="400" y="625" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">assembler</text>
  <text x="400" y="645" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Validates &amp; sorts results</text>
  
  <!-- Fan-in label -->
  <text x="400" y="590" font-family="Arial, sans-serif" font-size="11" font-style="italic" text-anchor="middle" fill="#666666">Automatic Fan-in (wait for all)</text>
  
  <!-- END node -->
  <circle cx="400" cy="750" r="25" fill="#D0021B" stroke="#000000" stroke-width="2" filter="url(#shadow)"/>
  <text x="400" y="757" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">END</text>
  
  <!-- Edges -->
  <!-- story_writer to image_prompter -->
  <line x1="350" y1="140" x2="150" y2="200" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="250" y="165" font-family="Arial, sans-serif" font-size="9" fill="#666666">parallel</text>
  
  <!-- story_writer to video_prompter -->
  <line x1="450" y1="140" x2="650" y2="200" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="550" y="165" font-family="Arial, sans-serif" font-size="9" fill="#666666">parallel</text>
  
  <!-- image_prompter to route_to_generators -->
  <line x1="190" y1="260" x2="350" y2="320" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="270" y="285" font-family="Arial, sans-serif" font-size="9" fill="#666666">fan-in</text>
  
  <!-- video_prompter to route_to_generators -->
  <line x1="610" y1="260" x2="450" y2="320" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="530" y="285" font-family="Arial, sans-serif" font-size="9" fill="#666666">fan-in</text>
  
  <!-- route_to_generators to generate_single_image -->
  <line x1="350" y1="380" x2="150" y2="450" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="250" y="410" font-family="Arial, sans-serif" font-size="9" fill="#666666">fan-out</text>
  
  <!-- route_to_generators to generate_single_video -->
  <line x1="450" y1="380" x2="650" y2="450" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="550" y="410" font-family="Arial, sans-serif" font-size="9" fill="#666666">fan-out</text>
  
  <!-- generate_single_image to assembler -->
  <line x1="150" y1="530" x2="350" y2="600" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="250" y="560" font-family="Arial, sans-serif" font-size="9" fill="#666666">fan-in</text>
  
  <!-- generate_single_video to assembler -->
  <line x1="650" y1="530" x2="450" y2="600" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="550" y="560" font-family="Arial, sans-serif" font-size="9" fill="#666666">fan-in</text>
  
  <!-- assembler to END -->
  <line x1="400" y1="660" x2="400" y2="725" stroke="#333333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Legend -->
  <rect x="50" y="800" width="700" height="180" rx="10" fill="#F9F9F9" stroke="#CCCCCC" stroke-width="1"/>
  <text x="400" y="825" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#333333">Legend</text>
  
  <rect x="80" y="845" width="30" height="20" rx="5" fill="#4A90E2" stroke="#000000" stroke-width="1"/>
  <text x="120" y="858" font-family="Arial, sans-serif" font-size="11" fill="#333333">Story Generation</text>
  
  <rect x="280" y="845" width="30" height="20" rx="5" fill="#7ED321" stroke="#000000" stroke-width="1"/>
  <text x="320" y="858" font-family="Arial, sans-serif" font-size="11" fill="#333333">Prompt Generation</text>
  
  <rect x="500" y="845" width="30" height="20" rx="5" fill="#F5A623" stroke="#000000" stroke-width="1"/>
  <text x="540" y="858" font-family="Arial, sans-serif" font-size="11" fill="#333333">Routing</text>
  
  <rect x="80" y="880" width="30" height="20" rx="5" fill="#BD10E0" stroke="#000000" stroke-width="1"/>
  <text x="120" y="893" font-family="Arial, sans-serif" font-size="11" fill="#333333">Media Generation</text>
  
  <rect x="280" y="880" width="30" height="20" rx="5" fill="#50E3C2" stroke="#000000" stroke-width="1"/>
  <text x="320" y="893" font-family="Arial, sans-serif" font-size="11" fill="#333333">Assembly</text>
  
  <circle cx="515" cy="890" r="10" fill="#D0021B" stroke="#000000" stroke-width="1"/>
  <text x="540" y="893" font-family="Arial, sans-serif" font-size="11" fill="#333333">End</text>
  
  <!-- Note -->
  <text x="400" y="950" font-family="Arial, sans-serif" font-size="10" font-style="italic" text-anchor="middle" fill="#666666">
    Note: generate_single_image and generate_single_video execute multiple times in parallel (one per prompt)
  </text>
</svg>